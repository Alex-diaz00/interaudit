{% extends 'layouts/base.html' %}
{% load static %}
{% load render_table from django_tables2 %}
{% load bootstrap4 %}

{% block content %}
<div class="relative">
    <h6 class="relative ml-10 mt-4 pl-2 border-2 border-black w-4/5 text-blue-500 text-xl">Gestionar usuario</h6>
    <div class="border-2 border-black ml-10 relative h-full p-3 w-4/5">

        <form action="{% url 'insertar_usuario' %}" autocomplete="off" method="POST">
            {% csrf_token %}

            <div class="grid grid-cols-4 flex flex-col">
                {{ usuario_form.non_field_errors }}
                <div class="flex flex-col m-2 w-52">
                    {{ usuario_form.username.errors }}
                    <label class="required" for="{{ usuario_form.username.id_for_label }}">Nombre de usuario:</label>
                    {{ usuario_form.username }}
                </div>

                <div class="flex flex-col m-2 w-52">
                    {{ usuario_form.password1.errors }}
                    <label class="required" for="{{ usuario_form.password1.id_for_label }}" name="password1">Contraseña:</label>
                    {{ usuario_form.password1 }}
                </div>

                <div class="flex flex-col m-2 w-52">
                    {{ usuario_form.password2.errors }}
                    <label class="required" for="{{ usuario_form.password2.id_for_label }}" name="password2">Confirmar contraseña:</label>
                    {{ usuario_form.password2 }}
                </div>


                <div class="flex flex-col m-2 w-52">
                    {{ usuario_form.email.errors }}
                    <label for="{{ usuario_form.email.id_for_label }}">Correo:</label>
                    {{ usuario_form.email }}
                </div>

                <div class="flex flex-col m-2 w-52">
                    {{ usuario_form.rol.errors }}
                    <label class="required" for="{{ usuario_form.rol.id_for_label }}">Rol:</label>
                    {{ usuario_form.rol }}
                </div>

                <!--            <div class="flex justify-start items-center m-2 w-52">-->
                <!--                {{ usuario_form.estado.errors }}-->
                <!--                <label for="{{ usuario_form.estado.id_for_label }}">Estado:</label>-->
                <!--                {{ usuario_form.estado }}-->
                <!--            </div>-->


            </div>

            <div class="flex flex-wrap space-x-12 block mt-6">
                <div class="flex w-full justify-end">
                    <input type="submit" value="Insertar" class="inline-block rounded bg-primary px-6 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-white shadow-[0_4px_9px_-4px_#3b71ca] transition duration-150 ease-in-out hover:bg-primary-600 hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:bg-primary-600 focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:outline-none focus:ring-0 active:bg-primary-700 active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] dark:shadow-[0_4px_9px_-4px_rgba(59,113,202,0.5)] dark:hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)]" >
                </div>
            </div>
        </form>
    </div>



    <div class="ml-10 mt-4 relative h-full">
        <h6 class="text-blue-500 text-xl">Listado de usuarios</h6>
    </div>

    {% if filter %}
    <form action="/home/usuarios/" method="get" class="ml-10 form space-x-4 form-inline">
        {% bootstrap_form filter.form layout='inline' %}
        <button type="submit" class="btn btn-primary">Filtrar</button>
    </form>
    {% endif %}

    <div class="ml-10 mt-4 relative">
        {% render_table table "includes/table.html" %}
    </div>

</div>
{% if errors %}
<script>
    Swal.fire({
    title: 'Error al registrar',
    html: '<ul>' +
    {% for field, error in errors.items %}
    '<li> {{ error|join:", " }}</li>' +
    {% endfor %}
    '</ul>',
        icon: 'error'
    });
</script>
{% endif %}

{% if added and not errors %}
<script>
    Swal.fire({
  icon: "success",
  title: "El usuario ha sido creado",
  showConfirmButton: false,
  timer: 1500
});
</script>
{% endif %}

{% if deleted and not errors %}
<script>
    Swal.fire({
  icon: "success",
  title: "El usuario ha sido eliminado",
  showConfirmButton: false,
  timer: 1500
});
</script>
{% endif %}

{% block extrastyle %}

<link href="{% static 'assets/css/ajax_datatable_style.css' %}" rel="stylesheet" />
<link href="{% static 'assets/css/jquery.dataTables.min.css' %}" />

{% endblock extrastyle %}

{% block extrajs %}

<script src="{% static 'assets/js/jquery-3.5.1.min.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/utils.js' %}"></script>
<script src="{% static 'assets/js/jquery.dataTables.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'assets/js/sweet_alert2.js' %}"></script>

<script>
    const btnsDelete = document.querySelectorAll(".btn-danger")
    const ths = document.querySelectorAll("th")
    const tds = document.querySelectorAll("td")
    const trs = document.querySelectorAll("tr")

    ths.forEach(function(element) {
        element.style.border = '2px solid black';
    });
    tds.forEach(function(element) {
        element.style.border = '1px solid black';
        element.style.textAlign = 'center';

    });

    trs.forEach(function(element) {
        element.style.border = '2px solid black';
    });


    btnsDelete.forEach((btn) => {
        btn.style.padding = "5px";
        btn.style.backgroundColor = "red";
        btn.style.borderRadius = "5px";
        btn.style.borderWidth = "inherit";
        btn.style.borderColor = "red";
        btn.style.margin = "inherit";
        btn.style.color = "white";

        btn.addEventListener("click", function(e) {
            e.preventDefault();
            delete_alert("¿Desea eliminar a " + btn.name +"?", e);
        })
    })




</script>



{% endblock extrajs %}



{% endblock content %}